<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>WebSocket STOMP Test (SockJS)</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
    <h1>WebSocket STOMP ì—°ê²° í…ŒìŠ¤íŠ¸</h1>
    <div>
        <button onclick="connect()">ì—°ê²°</button>
        <button onclick="disconnect()">ì—°ê²° í•´ì œ</button>
        <button onclick="sendMessage()">ë©”ì‹œì§€ ì „ì†¡</button>
    </div>
    <div>
        <h3>ë¡œê·¸:</h3>
        <div id="log" style="border: 1px solid #ccc; height: 400px; overflow-y: scroll; padding: 10px;"></div>
    </div>

    <script>
        let stompClient = null;
        
        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function connect() {
            const socket = new SockJS('http://localhost:8080/ws-stomp');
            stompClient = Stomp.over(socket);
            
            stompClient.connect({}, function(frame) {
                log('âœ… STOMP ì—°ê²° ì„±ê³µ: ' + frame);
                
                // ì±„íŒ…ë°© êµ¬ë…
                stompClient.subscribe('/sub/chat/room/1', function(message) {
                    log('ğŸ“¨ ë©”ì‹œì§€ ìˆ˜ì‹ : ' + message.body);
                });
                
            }, function(error) {
                log('âŒ STOMP ì—°ê²° ì‹¤íŒ¨: ' + error);
            });
        }
        
        function disconnect() {
            if (stompClient !== null) {
                stompClient.disconnect();
                log('ğŸ”Œ ì—°ê²° í•´ì œë¨');
            }
        }
        
        function sendMessage() {
            if (stompClient !== null) {
                const message = {
                    chatroomId: 1,
                    senderId: 2,
                    content: 'ë¸Œë¼ìš°ì €ì—ì„œ ë³´ë‚¸ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€!',
                    type: 'CHAT'
                };
                
                stompClient.send('/pub/chat/message', {}, JSON.stringify(message));
                log('ğŸ“¤ ë©”ì‹œì§€ ì „ì†¡: ' + message.content);
            } else {
                log('âŒ ì—°ê²°ë˜ì§€ ì•ŠìŒ');
            }
        }
    </script>
</body>
</html>